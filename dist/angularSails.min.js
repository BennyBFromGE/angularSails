/*
  angularSails 0.0.0-build1395442610826
  Built with <3 by Balderdashy*/
!function(){"use strict";var a=angular.module("sailsBaseCollection",[]);a.factory("collectionUtils",function(){var a={},b=Array.prototype,c={},d=b.forEach,e=Object.keys,f=b.some;return a.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},a.has=function(a,b){return hasOwnProperty.call(a,b)},a.isObject=function(a){return a===Object(a)},a.keys=function(b){if(!a.isObject(b))return[];if(e)return e(b);var c=[];for(var d in b)a.has(b,d)&&c.push(d);return c},a.each=function(b,e,f){if(null==b)return b;if(d&&b.forEach===d)b.forEach(e,f);else if(b.length===+b.length){for(var g=0,h=b.length;h>g;g++)if(e.call(f,b[g],g,b)===c)return}else for(var i=a.keys(b),j=0,k=i.length;k>j;j++)if(e.call(f,b[i[j]],i[j],b)===c)return;return b},a.identity=function(a){return a},a.any=function(b,d,e){d||(d=a.identity);var g=!1;return null==b?g:f&&b.some===f?b.some(d,e):(a.each(b,function(a,b,f){return g||(g=d.call(e,a,b,f))?c:void 0}),!!g)},a.find=function(b,c,d){var e;return a.any(b,function(a,b,f){return c.call(d,a,b,f)?(e=a,!0):void 0}),e},a.findWhere=function(b,c){return a.find(b,a.matches(c))},{findWhere:a.findWhere}})}(),function(a){"use strict";var b=angular.module("angularSails.io",[]);b.provider("sailsSocketFactory",function(){var b="sails:";this.$get=["$q","$rootScope","$timeout","$window",function(c,d,e,f){var g=function(a,b){return b?function(){var c=arguments;e(function(){b.apply(a,c)},0)}:angular.noop},h=function(b,d,e,f){var h=c.defer();e=e.replace(/^(.+)\/*\s*$/,"$1"),d=d||"get","string"!=typeof e&&h.reject(new Error("Invalid or missing URL!\n"));var i=a.JSON.stringify({url:e,data:f});return b.emit(d,i,g(b,function(b){var c=b;if(b&&"string"==typeof b)try{c=a.JSON.parse(b)}catch(d){return"undefined"!=typeof console&&console.warn("Could not parse:",b,d),h.reject("Server response could not be parsed!\n"+b)}switch(c.status){case 404:return h.reject(new Error("404: Not found"));case 403:return h.reject(new Error("403: Forbidden"));case 500:return h.reject(new Error("500: Server Error"));default:return h.resolve(c)}})),h.promise};return function(c){c=c||{};var e=f.location.origin||"http://localhost:1337";if(c.token){var i="?token="+c.token;e+=i}var j=c.ioSocket||a.connect(e),k=c.prefix||b,l=c.scope||d,m=function(a,b){j.on(a,g(j,b))},n={on:m,addListener:m,emit:function(a,b,c){return j.emit(a,b,g(j,c))},removeListener:function(){return j.removeListener.apply(j,arguments)},forward:function(a,b){a instanceof Array==!1&&(a=[a]),b||(b=l),a.forEach(function(a){var c=k+a,d=g(j,function(a){b.$broadcast(c,a)});b.$on("$destroy",function(){j.removeListener(a,d)}),j.on(a,d)})},get:function(a,b){return h(j,"get",a,b)},post:function(a,b){return h(j,"post",a,b)},put:function(a,b){return h(j,"put",a,b)},"delete":function(a,b){return h(j,"delete",a,b)}};return n}}]})}(window.io||{JSON:window.JSON,connect:angular.noop}),function(){"use strict";var a=angular.module("angularSails.base",["angularSails.io","sailsBaseCollection"]);a.filter("collectionToArray",function(){return function(a){var b=[];return angular.forEach(a,function(a,c){isNaN(c)||b.push(a)}),b}}),a.factory("angularSailsSocket",["sailsSocketFactory",function(a){return a()}]),a.factory("$sailsRef",["angularSailsSocket","collectionUtils",function(a,b){var c=function(a,b,c,d){this.angularSailsSocket=a,this.collectionUtils=b,this.url=c,this.query=d,this._resource={},this.collectionCounter=0,this._reourceId=this.url.slice(1),this.socketModelCid=void 0};return c.prototype={construct:function(){var a=this,b=a.angularSailsSocket.get(a.url,a.query);return b.then(function(b){angular.isArray(b)?a._constructCollection(b):a._constructModel(b)}),a._resource},_getModel:function(a){var b,c={};if(angular.isObject(a))b=a.hasOwnProperty("cid")?a.cid:a.id;else if(angular.isString(a))b=parseInt(a,10);else{if(!angular.isNumber(a))throw new Error("Must pass a model object, criteria object, string id, or number id");b=a}return c=this._resource[b]},_getAttributes:function(a){var b={};return angular.forEach(a,function(a,c){"$"!==c.charAt(0)&&"cid"!==c&&(b[c]=a)}),b},_updateModel:function(a,c,d){var e;if("read"===c||"created"===c)a.$collection=this._resource,e=this._constructModel(a);else if("updated"===c||"destroyed"===c)if(d){var f=b.findWhere(this._resource,{createdAt:a.createdAt});e=angular.extend(f,a)}else e=a;"destroyed"!==c?this._resource[e.cid]=e:delete this._resource[e.cid]},_setCollectionListeners:function(){var a=this,b=a.url.slice(1);a.angularSailsSocket.on(b,function(b){var c=b.verb,d=b.data||b.previous,e=!0;a._updateModel(d,c,e)})},_setModelListeners:function(){},_assignCid:function(a){a.cid=++this.collectionCounter},_constructCollection:function(a){var b=this,c={};c.$add=function(a){b.angularSailsSocket.post(b.url,a).then(function(a){b._updateModel(a,"created")})},c.$update=function(a){var c=b._getModel(a),d=b._getAttributes(c);b.angularSailsSocket.put(b.url+"/"+d.id,d).then(function(a){var d=angular.extend(a,c);b.socketModelCid=c.cid,b._updateModel(d,"updated")})},c.$save=function(){},c.$remove=function(a){var c=b._getModel(a),d=b._getAttributes(c);b.angularSailsSocket.delete(b.url,d).then(function(){b.socketModelCid=c.cid,b._updateModel(c,"destroyed")})},angular.extend(b._resource,c),angular.forEach(a,function(a){b._updateModel(a,"read")}),b._setCollectionListeners()},_constructModel:function(a){function b(){return d.$collection}var c=this,d=a;return d.$update=d.$save=function(){b()&&d.$collection.$update(d)},d.$remove=function(){b()&&d.$collection.$remove(d)},d.cid||c._assignCid(d),d}},function(d,e){var f=new c(a,b,d,e);return f.construct()}}])}();
//# sourceMappingURL=angularSails.min.map
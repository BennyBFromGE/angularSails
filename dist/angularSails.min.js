/*
  angularSails 0.0.0-build1395708259041
  Built with <3 by Balderdashy*/
!function(){"use strict";var a=angular.module("sailsBaseCollection",[]);a.factory("collectionUtils",function(){var a={},b=Array.prototype,c={},d=b.forEach,e=Object.keys,f=b.some;return a.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},a.has=function(a,b){return hasOwnProperty.call(a,b)},a.isObject=function(a){return a===Object(a)},a.keys=function(b){if(!a.isObject(b))return[];if(e)return e(b);var c=[];for(var d in b)a.has(b,d)&&c.push(d);return c},a.each=function(b,e,f){if(null==b)return b;if(d&&b.forEach===d)b.forEach(e,f);else if(b.length===+b.length){for(var g=0,h=b.length;h>g;g++)if(e.call(f,b[g],g,b)===c)return}else for(var i=a.keys(b),j=0,k=i.length;k>j;j++)if(e.call(f,b[i[j]],i[j],b)===c)return;return b},a.identity=function(a){return a},a.any=function(b,d,e){d||(d=a.identity);var g=!1;return null==b?g:f&&b.some===f?b.some(d,e):(a.each(b,function(a,b,f){return g||(g=d.call(e,a,b,f))?c:void 0}),!!g)},a.find=function(b,c,d){var e;return a.any(b,function(a,b,f){return c.call(d,a,b,f)?(e=a,!0):void 0}),e},a.findWhere=function(b,c){return a.find(b,a.matches(c))},{findWhere:a.findWhere}})}(),angular.module("angularSails.io",[]).constant("$SAILS_CONNECTION_METADATA_PARAMS",{version:"__sails_io_sdk_version",platform:"__sails_io_sdk_platform",language:"__sails_io_sdk_language"}).constant("$SAILS_SDK_PARAMS",{version:"0.10.0",platform:"undefined"==typeof module?"browser":"node",language:"javascript",flavor:"angular"}).factory("$SAILS_SDK_INFO",["$SAILS_CONNECTION_METADATA_PARAMS","$SAILS_SDK_PARAMS",function(a,b){function c(){var c=a.version+"="+b.version+"&"+a.platform+"="+b.platform+"&"+a.language+"="+b.language;return c}return console.log(a),{getVersionString:c}}]).factory("SocketIo",["$window",function(a){if(!a.io)throw new Error("Socket IO Not Found!");return a.io}]).provider("$sailsSocket",function(){var a=function(a,b,c,d){function e(){var a={};this.socket={connected:!1},this.on=function(b,c){return a[b]=c,this},this.become=function(b){for(var c in a)b.on(c,a[c]);return b}}function f(a,b){this.data=b.body||{},this.headers=b.headers||{},this.status=b.statusCode||b.body.status||200,this.config=a}function g(a,b){var c=b.response;delete b.response;var d=b.method;a.emit(d,b,i(a,function(a){var d=new f(b,a);d.status>=400?c.reject(d):c.resolve(d)}))}var h=d.getVersionString(),i=function(a,c){return c?function(){var d=arguments;b(function(){console.log("calling"),console.log(d),c.apply(a,d)},0)}:angular.noop};f.prototype.toString=function(){return"[ResponseFromSails]  -- Status: "+this.statusCode+"  -- Headers: "+this.headers+"  -- Body: "+this.body},f.prototype.toPOJO=function(){return{data:this.body,headers:this.headers,status:this.statusCode,config:this.config}};var j=function(a){var b=this;b._requestQueue=[],b._socketOptions=a||{},b._socket=new e};return j.prototype.connect=function(b,d){var e=a.defer(),f=this;d=d||{},b=b||f._socketOptions.baseUrl||void 0,"string"!=typeof d.query?d.query=h:d.query+="&"+h;var i=c.connect(b,d);return f._socket=f._socket.become(i),f._socket.on("connect",function(){angular.forEach(f._requestQueue,function(a){g(f._socket,a)})}),f._socket.once("connect",e.resolve),f._socket.on("connecting",e.notify),f._socket.once("connect_failed",e.reject),e.promise},j.prototype.isConnected=function(){return this._socket.socket.connected},j.prototype.get=function(a,b){return thissa._request({method:"get",url:a,data:b})},j.prototype.post=function(a,b){return this._request({method:"post",url:a,data:b})},j.prototype.post=function(a,b){return this._request({method:"post",url:a,data:b})},j.prototype["delete"]=function(a,b){return this._request({method:"delete",url:a,data:b})},j.prototype._request=function(b){var c=a.defer(),d="Usage:\n socket."+(b.method||"request")+"( destinationURL, [dataToSend] )";if(b=b||{},b.data=b.data||{},b.headers=b.headers||{},b.url=b.url.replace(/^(.+)\/*\s*$/,"$1"),"string"!=typeof b.url)throw new Error("Invalid or missing URL!\n"+d);var e=this,f={method:b.method,data:b.data,url:b.url,headers:b.headers,response:c};return c.promise.success=function(a){return c.promise.then(function(b){a(b.data,b.statusCode,b.headers,f)}),c.promise},c.promise.error=function(a){return c.promise.then(null,function(b){a(b.data,b.statusCode,b.headers,f)}),c.promise},e._socket&&e.isConnected()?g(_self._socket,f):e._requestQueue.push(f),c.promise},j.prototype.on=function(a,b){var c=this;c._socket.on(a,i(c._socket,b))},function(a){var b=new j(a);return b}};return{$get:["$q","$timeout","SocketIo","$SAILS_SDK_INFO",a]}}),function(){"use strict";var a=angular.module("angularSails.base",["angularSails.io","sailsBaseCollection"]);a.filter("collectionToArray",function(){return function(a){var b=[];return angular.forEach(a,function(a,c){isNaN(c)||b.push(a)}),b}}),a.factory("angularSailsSocket",["sailsSocketFactory",function(a){return a()}]),a.factory("$sailsRef",["angularSailsSocket","collectionUtils",function(a,b){var c=function(a,b,c,d){this.angularSailsSocket=a,this.collectionUtils=b,this.url=c,this.query=d,this._resource={},this.collectionCounter=0,this._reourceId=this.url.slice(1),this.socketModelCid=void 0};return c.prototype={construct:function(){var a=this,b=a.angularSailsSocket.get(a.url,a.query);return b.then(function(b){angular.isArray(b)?a._constructCollection(b):a._constructModel(b)}),a._resource},_getModel:function(a){var b,c={};if(angular.isObject(a))b=a.hasOwnProperty("cid")?a.cid:a.id;else if(angular.isString(a))b=parseInt(a,10);else{if(!angular.isNumber(a))throw new Error("Must pass a model object, criteria object, string id, or number id");b=a}return c=this._resource[b]},_getAttributes:function(a){var b={};return angular.forEach(a,function(a,c){"$"!==c.charAt(0)&&"cid"!==c&&(b[c]=a)}),b},_updateModel:function(a,c,d){var e;if("read"===c||"created"===c)a.$collection=this._resource,e=this._constructModel(a);else if("updated"===c||"destroyed"===c)if(d){var f=b.findWhere(this._resource,{createdAt:a.createdAt});e=angular.extend(f,a)}else e=a;"destroyed"!==c?this._resource[e.cid]=e:delete this._resource[e.cid]},_setCollectionListeners:function(){var a=this,b=a.url.slice(1);a.angularSailsSocket.on(b,function(b){var c=b.verb,d=b.data||b.previous,e=!0;a._updateModel(d,c,e)})},_setModelListeners:function(){},_assignCid:function(a){a.cid=++this.collectionCounter},_constructCollection:function(a){var b=this,c={};c.$add=function(a){b.angularSailsSocket.post(b.url,a).then(function(a){b._updateModel(a,"created")})},c.$update=function(a){var c=b._getModel(a),d=b._getAttributes(c);b.angularSailsSocket.put(b.url+"/"+d.id,d).then(function(a){var d=angular.extend(a,c);b.socketModelCid=c.cid,b._updateModel(d,"updated")})},c.$save=function(){},c.$remove=function(a){var c=b._getModel(a),d=b._getAttributes(c);b.angularSailsSocket.delete(b.url,d).then(function(){b.socketModelCid=c.cid,b._updateModel(c,"destroyed")})},angular.extend(b._resource,c),angular.forEach(a,function(a){b._updateModel(a,"read")}),b._setCollectionListeners()},_constructModel:function(a){function b(){return d.$collection}var c=this,d=a;return d.$update=d.$save=function(){b()&&d.$collection.$update(d)},d.$remove=function(){b()&&d.$collection.$remove(d)},d.cid||c._assignCid(d),d}},function(d,e){var f=new c(a,b,d,e);return f.construct()}}])}();
//# sourceMappingURL=angularSails.min.map